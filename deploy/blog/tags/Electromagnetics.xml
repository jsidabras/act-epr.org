<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:base="http://act-epr.org">
  <title>
    Act-EPR  </title>
    <link href="http://act-epr.org/blog/tags/Electromagnetics.xml" rel="self" />
  
    <link href="http://act-epr.org/blog/"/>
  
    
  <updated>2019-11-17T13:58:06Z</updated>

  <id>http://act-epr.org/blog/tags/Electromagnetics.xml</id>

      <entry>
    <title type="html">Uniform Field Re-Entrant Cavity for Improved Pulse EPR</title>
    <author><name>Jason W. Sidabras</name></author>
    <link href="http://act-epr.org/blog/2017/uniform-field-reEntrant-cavity"/>
    <link rel="alternate" type="text/html" href="http://act-epr.org/blog/2017/uniform-field-reEntrant-cavity"/>
    <updated>2017-10-20T06:00:00Z</updated>
    <published>2017-10-20T06:00:00Z</published>
    <id>http://act-epr.org/blog/2017/uniform-field-reEntrant-cavity</id>
        <category term="Electromagnetics" label="Electromagnetics" />
        <category term="Published Work" label="Published Work" />
        <category term="Resonator Design" label="Resonator Design" />
    
    <content type="html">
                  &lt;p&gt;A recent publication in &lt;a href=&#34;https://link.springer.com/article/10.1007/s00723-017-0955-0&#34;&gt;Applied Magnetic Resonance&lt;/a&gt; describes a new uniform field (UF) resonator that has been optimized for pulse experiments. The UF geometry is described as a re-entrant cylindrical TE&lt;sub&gt;01U&lt;/sub&gt; cavity at Q-band (34 GHz). The re-entrant geometry is calculated to have the same electron paramagnetic resonance (EPR) signal intensity as a traditional TE&lt;sub&gt;011&lt;/sub&gt; cavity, a 60% increase in average resonator efficiency Î›ave over the sample, and has a B&lt;sub&gt;1&lt;/sub&gt;  profile that is 79.8% uniform over the entire sample volume (98% uniform over the region-of-interest).&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://aip.scitation.org/doi/abs/10.1063/1.1510549&#34;&gt;Uniform field resonators were introduced in 2002&lt;/a&gt; by my colleagues at the Medical College of Wisconsin and since then a number of publications have expanded the field to &lt;a href=&#34;https://link.springer.com/article/10.1007/BF03166603&#34;&gt;Uniform Field Loop-Gap Resonators&lt;/a&gt;, &lt;a href=&#34;http://www.sciencedirect.com/science/article/pii/S1090780717301982?via%3Dihub&#34;&gt;High-Frequency LGR and Cavity Resonators&lt;/a&gt;, and recently Mett &lt;i&gt;et al.&lt;/i&gt; published a study introducing &lt;a href=&#34;https://link.springer.com/article/10.1007/s00723-017-0935-4&#34;&gt;non-resonant dielectric tubes&lt;/a&gt; to a cylindrical Uniform Field TE&lt;sub&gt;01U&lt;/sub&gt; cavity. However, no studies have looked at increasing the resonator efficiency over the sample for pulse spectroscopy. My recent paper addresses this concern.&lt;/p&gt;
&lt;div class=&#34;container&#34;&gt;&lt;div class=&#34;col-md-5&#34; style=&#34;padding-left: 0px;  padding-right: 0px;&#34;&gt;&lt;img style=&#34;max-width:100%;height:auto;&#34; src=&#34;/media/blog/2017/img/blog-UF-Fig1-geo.png&#34; title=&#34;Uniform Field Re-Entrant TE01U Geometry&#34;&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The advantage of UF resonators is the ability to extend the region-of-interest of a traditional cavity to increase concentration sensitivity by increasing volume. However, as you increase the volume of the resonator the resonator efficiency lowers. To saturate your spins, you would need more power for the same field at the sample. The re-entrant geometry overcomes this issue by introducing fins into the cavity. These fins perform three major functions:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Confine the electric field, providing distributed capacitance, that lowers the cut-off frequency of the cavity. In order to maintain a cut-off frequency of 34 GHz, the overall cavity radius must be reduced, which increases the stored energy.&lt;/li&gt;
&lt;li&gt;Provide current, and magnetic field, close to the sample increasing the magnetic field concentration and minimizing magnetic field perturbations that can exist in a typical cavity. The fins can also be thought of as reducing mode coupling to perturbation modes.&lt;/li&gt;
&lt;li&gt;By not having the fins in the end section a smaller volume is needed to provide the open circuit match needed to obtain the uniform field. This reduces the volume of the sample that sees non-uniform return field in the end sections.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The end sections were designed with low-loss Rexolite plastic and provide an electromagnetic discontinuity to transfer the end-plate short to an open. Such a design is easy to manufacture with re-entrant geometries at Q- and W-band, unlike loop-gap resonators where the gaps are too small to machine plastic caps. Because of this a true uniform field can be realized.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
&lt;div class=&#34;container&#34;&gt;&lt;div class=&#34;col-md-8&#34; style=&#34;padding-left: 0px;  padding-right: 0px;&#34;&gt;&lt;img style=&#34;max-width:100%;height:auto;&#34; src=&#34;/media/blog/2017/img/blog-UF-Fig2-UFCompare.png&#34; title=&#34;Comparison of Uniform Field Resonators with different dielectrics&#34;&gt; &lt;/div&gt;&lt;/div&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;One important aspect of the re-entrant geometry is the stability of the uniform field mode. Shown on the left is a Uniform Field Cylindrical TE&lt;sub&gt;01U&lt;/sub&gt; resonator (which can include the dielectric tube) as the dielectric constant of the sample is changed from an epsilon of 1 to 5 (dark to light). The dotted lines indicate the 10 mm region-of-interest. This simulates placing different samples in the resonator, for instance changes in glycerol content. The field uniformity swings from a &#39;W&#39; shape to a slightly cosine shape. And the end sections change significantly. Experimentally this would mean a change in the pi pulse needed to excite the sample. Although this is much better than the traditional TE&lt;sub&gt;011&lt;/sub&gt; cavity, it could be improved.&lt;/p&gt;
&lt;p&gt;On the right shows the same sample change from epsilon 1 to 5 (dark to light). It is apparent that the variation is much smaller with the re-entrant geometry. This is due to the fins reducing the electric field in the sample and, consequently, reducing the frequency shift as the sample is changed. For instance, the cylindrical TE&lt;sub&gt;01U&lt;/sub&gt; geometry has a 1.3 GHz shift, while the re-entrant TE&lt;sub&gt;01U&lt;/sub&gt; geometry only shifts by 810 MHz. This exciting feature of the re-entrant resonator may allow it to become a general purpose resonator for pulse experiments.&lt;/p&gt;
&lt;p&gt;Additionally, since the electric field is reduced you could even put a water sample (0.255 ID, 2.8 mm OD quartz tube) and still obtain the uniform field! This thick wall tube would be perfect for high pressure experiments.&lt;/p&gt;
&lt;div class=&#34;container&#34;&gt;&lt;div class=&#34;col-md-5&#34; style=&#34;padding-left: 0px;  padding-right: 0px;&#34;&gt;&lt;img style=&#34;max-width:100%;height:auto;&#34; src=&#34;/media/blog/2017/img/blog-UF-Fig3-nutation.png&#34; title=&#34;Nutation experiment comparing the TE011 vs the re-entrant TE01U&#34;&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first experiment performed to test the re-entrant resonator was a simple nutation experiment. This experiment relies on coherent preparation pulse, which requires uniform fields. Performing the experiment in a traditional TE&lt;sub&gt;011&lt;/sub&gt; yields sub-par results. The nutations roll-off quickly, there are phase-inversions at 1200 ns 2400 ns, and there is a complex background. If this was a DEER experiment, these would all create unwanted distances due to frequency content created &lt;b&gt;only by the non-uniformity of the resonator&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;By placing the sample in the re-entrant TE&lt;sub&gt;01U&lt;/sub&gt; cavity, these issues disappear and you are left with a clean nutation experiment with reasonable roll-off and no complex background. However, by preparing a sample that sits only in the 10 mm region of interest the nutations can be extended even further.&lt;/p&gt;
&lt;p&gt;In the future I plan on testing this resonator using other coherent pulse spectroscopies, such as ESEEM/HYSCORE, DEER, and EDNMR. The larger bandwidth and uniform fields of the re-entrant TE&lt;sub&gt;01U&lt;/sub&gt; with the same concentration sensitivity should provide a superior resonator and pave the way for uniform field resonators to be used for general purpose spectroscopy. &lt;/p&gt;
&lt;p&gt;The design drawings and STL field can be found in the &lt;a href=&#34;/data/&#34;&gt;Data Section&lt;/a&gt; of this web-site.&lt;/p&gt;      
          </content>
  </entry>
    <entry>
    <title type="html">Boosting Ansys HFSS Performance</title>
    <author><name>Jason W. Sidabras</name></author>
    <link href="http://act-epr.org/blog/2017/boosting-ansys-hfss-performance"/>
    <link rel="alternate" type="text/html" href="http://act-epr.org/blog/2017/boosting-ansys-hfss-performance"/>
    <updated>2017-04-28T06:00:00Z</updated>
    <published>2017-04-28T06:00:00Z</published>
    <id>http://act-epr.org/blog/2017/boosting-ansys-hfss-performance</id>
        <category term="Ansys HFSS" label="Ansys Hfss" />
        <category term="Tips and Tricks" label="Tips And Tricks" />
        <category term="Electromagnetics" label="Electromagnetics" />
        <category term="Simulations" label="Simulations" />
    
    <content type="html">
                  &lt;p&gt;After 12 years of running Ansys (previously Ansoft) &lt;a href=&#34;http://www.ansys.com/products/electronics/ansys-hfss&#34;&gt;High Frequency Structure Simulator&lt;/a&gt; I have a series of helpful tricks to improve the performance of your simulations. Over the last 5 years Ansys HFSS has significantly improved in its ability to handle multiple processors and now even support GPU acceleration for iterative solutions. However, there are always going to be bottlenecks.&lt;/p&gt;
&lt;h3&gt;The right computer for the job.&lt;/h3&gt;
&lt;p&gt;The first thing you need is a good computer. Ansys HFSS can run on any Windows computer, but we are not interested in just running this simulation package but to squeeze every last ounce of power out of it. The &lt;strong&gt;most important&lt;/strong&gt; part is the L2 cache size of a processor. This is the scratch pad of the calculation and the bigger this is, the less amount of time the program will be using memory and &lt;em&gt;shudder&lt;/em&gt; disk space.&lt;/p&gt;
&lt;p&gt;I personally have preferred Intel Xeon chips and they remain the industry standard. Load up the cores (one for each purchased High Performance Computing License) and buy a system with 2 processors. Hyper-threading has come a long way in terms of performance, but it is still split by CPU cycles. In terms of raw simulation power, Hyper-threading (IMHO) doesn&#39;t cut it. I have seen 10-15% improvements without Hyper-threading. &lt;/p&gt;
&lt;p&gt;Ever since Intel introduced &lt;a href=&#34;https://en.wikipedia.org/wiki/Intel_QuickPath_Interconnect&#34;&gt;QuickPath Interconnect&lt;/a&gt; to the Northbridge Chipset, the memory interface has been optimized for data transfer from the chipset. This is highly desired in simulation programs like HFSS. And we will use this later when we set up a &lt;a href=&#34;https://en.wikipedia.org/wiki/RAM_drive&#34;&gt;RAMDrive&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Ensure your RAM is ECC protected (to minimize bit failure) and load it up. My current computer is up to 128 GB of DDR4 RAM. However, I&#39;ve had the privilege of having a workstation with 512 GB of DDR4 RAM. It was needed to solve a &lt;a href=&#34;http://aip.scitation.org/doi/abs/10.1063/1.4961573?journalCode=rsi&#34;&gt;complex problem&lt;/a&gt; where the typical boundary conditions of electric field on a metal surface was not correct. Therefore we had to solve &lt;strong&gt;inside&lt;/strong&gt; the metal. This increases the mesh needed immensely and needed lots of RAM to solve.&lt;/p&gt;
&lt;p&gt;What is interesting is that the GPU is not as critical as you expect. And unless you expecting to utilize the GPU solver for iterative solutions a mid-high end nVidia card will be sufficient. Currently, standard DrivenMode (Terminal and Modal) and EigenMode &lt;em&gt;do not&lt;/em&gt; utilize the GPU.&lt;/p&gt;
&lt;h3&gt;Your data is worth more than gold&lt;/h3&gt;
&lt;p&gt;I need to put this in its own section. &lt;strong&gt;There is nothing more important than the safety of your data.&lt;/strong&gt; Windows 7 Professional and Ansys HFSS should be installed on a SSD, but you can&#39;t trust the MTBF of an SSD for your data. Instead you should at least have a RAID1 volume to store your data. &lt;/p&gt;
&lt;p&gt;However, I am paranoid. In addition to the RAID1 volume I use &lt;a href=&#34;https://itefix.net/cwrsync&#34;&gt;cwrsync&lt;/a&gt; to backup my HFSS files to a secured remote server. By backing up the hfss files you save significantly on space (and backup time) while maintaining the most important parts. This is done by EXCLUDE command to exclude the solution folders.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rsync.exe -avz --delete-after --prune-empty-dirs --exclude &#34;*.hfssresults&#34; --exclude &#34;*.mxwlresults&#34; --exclude &#34;*_files&#34; --exclude &#34;*.adsnresults&#34; &#34;/cygdrive/D/Maxwell&#34;  &#34;username@servername:~/Backup/&#34;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This code ensures that your Backup server is &lt;em&gt;exactly&lt;/em&gt; like your current drive. If you delete something in the local hard drive this will delete it in the server. There are other ways to &lt;a href=&#34;http://www.mikerubel.org/computers/rsync_snapshots/&#34;&gt;backup using rsync&lt;/a&gt; and maybe you would like a different scheme.&lt;/p&gt;
&lt;p&gt;Set cwrsync to &lt;a href=&#34;https://www.nextofwindows.com/how-to-run-a-script-or-command-at-logoff-in-windows-7-8&#34;&gt;backup when you logoff&lt;/a&gt; or &lt;a href=&#34;https://www.howtogeek.com/123393/how-to-automatically-run-programs-and-set-reminders-with-the-windows-task-scheduler/&#34;&gt;run at a certain time every day&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;RAMDrive: Eliminated the Bottleneck&lt;/h3&gt;
&lt;p&gt;Running a simulation on a RAID1 drive is not the best idea. First, it increases the MTBF of the drives. Second, it creates a significant bottleneck due to the speeds of the hard drives compared to the SSD. At the very least you should be running your simulations on the SSD and use the RAID1 volume for backup.&lt;/p&gt;
&lt;p&gt;However, there is an advanced way to get (theoretically) over 4 GB/s throughput. Using a RAMDrive. A RAMDrive is when you format part of your system memory and create a usable drive. Although this is risky (RAM is volatile, computer reboot will lose data) the speedup is worth it for long solutions. &lt;/p&gt;
&lt;p&gt;Before we get into the setup, you must be aware that Ansys HFSS uses both the TEMP directory &lt;strong&gt;and&lt;/strong&gt; the .adsnresults folders when solving. So we must make the RAMDrive large enough to handle our solution. In one instance our .adsnresults folder was over 200 GB due to a Direct Solver of the sweep and keeping the fields. Obviously we didn&#39;t run this in a RAMDrive, but instead on the SSD. &lt;/p&gt;
&lt;p&gt;For years I have been using &lt;a href=&#34;http://winramtech.hostei.com/RAMDriv/&#34;&gt;WinRamTech RAMDisc&lt;/a&gt; with a lot of success. I highly recommend purchasing the 64-bit enterprise version for $11 (I get &lt;strong&gt;no&lt;/strong&gt; kickback.) Installation is simple and configuration is straight forward. I typically set up a 8-24 GB RAMDrive depending on the problem at hand. &lt;/p&gt;
&lt;p&gt;First, remember to set your TEMP directory to be inside the RAMDrive. Everyday running (8 GB RAMDrive) should have the TEMP directory set up. If your computer reboots, you only lose partial solutions. &lt;/p&gt;
&lt;p&gt;When you are ready to solve you should &lt;em&gt;Save As...&lt;/em&gt; from your working file to the RAMDrive. Ansys HFSS builds the .adsnresults folder where the HFSS file is located. With this your solutions will easily be cut by 50%. &lt;/p&gt;
&lt;h3&gt;Forcing Mesh Optimization&lt;/h3&gt;
&lt;p&gt;The meshing function in Ansys HFSS is quite good and has gotten better over the years. But there are a few key ideas that you can use to to optimize your solution space. &lt;/p&gt;
&lt;p&gt;Ansys HFSS uses corners and edges to start the initial mesh. It then refines the mesh based on dielectric properties. After a first solution, Ansys increases the mesh at volumes of maximum electric field and generally increases the solution. Although this is a good way to solve for ports and antenna, it tends to over compensate in magnetic resonance resonator and surface coil design. &lt;/p&gt;
&lt;p&gt;In order to guide better mesh optimization I use three methods. The first is to chose the number of sides for a cylindrical object. The default HFSS cylinder only has 12 edges and it is visually made smooth. However, you can set the number of size (typically 32 works nicely). This increases the edges and corners for mesh to attached.&lt;/p&gt;
&lt;p&gt;The second is to create small vacuum regions in your gaps (for a loop-gap resonator) or around important coupling sections (for a planar micro-resonator). These vacuum regions can be individually meshed to focus the algorithm on important features.&lt;/p&gt;
&lt;p&gt;Finally, in order to make the beautiful figure on the top I had to create hundreds of 0.1 mm boxes around the sample and into the vacuum region. Regular meshing created a very choppy Ephi plot (Figure B and C) and a much finer mesh was needed. However all of the zero region forced a lot of wasted mesh. By creating the boxes or volumes around the sample a significant was formed at the points of interest. Such as the sample/volume interface and the &lt;a href=&#34;https://doi.org/10.1016/j.jmr.2017.02.009&#34;&gt;Type III dipole interface at the edges of the finite sample size&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;I hope this post helps in speeding up your Ansys HFSS solutions. I will add more and refine this post as I learn more!&lt;/p&gt;
&lt;p&gt;Good luck and happy simulating.&lt;/p&gt;      
          </content>
  </entry>
  

</feed>