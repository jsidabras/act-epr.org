<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Packaging Python software with pbr | Julien Danjou</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Jason W. Sidabras">

    <link href="/media/css/bootstrap.min.css" rel="stylesheet">
    <link href="/media/css/style.css" rel="stylesheet">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="/media/js/libs/bootstrap.min.js"></script>
 
   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <!-- fonts -->
    <link href='http://fonts.googleapis.com/css?family=Nunito:300,400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,500,600,700' rel='stylesheet' type='text/css'>
    <link href='/media/css/font-awesome.min.css' rel="stylesheet" type="text/css">
    <link href='/media/css/academicons.min.css' rel="stylesheet" type="text/css">
    <!-- nfonts -->
        
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-25393581-1', 'auto', {'allowLinker': true});
        ga('send', 'pageview');
    </script>


        <link rel="shortcut icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
    
        
      </head>

  <body class="packaging-python-with-pbr">
        <!-- start main wrapper -->
        <div id="header"><!-- start main header -->
            <div class="top-line">&nbsp;</div>
                <div class="top"><!-- top -->
                    <div class="container">
                        <div class="media-top-right">
                            <ul class="media-top clearfix">
                                <li class="item"><a href="https://www.linkedin.com/in/jason-sidabras-596466b6" target="blank"    ><i class="fa fa-linkedin-square ai-2x"></i></a></li>
                                <li class="item"><a href="https://scholar.google.com/citations?user=pbXGcaoAAAAJ" target="blank"><i class="ai ai-google-scholar ai-2x"></i></a></li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div><!-- top -->
                <div class="container"><!-- container -->
                    <div class="row">
                        <div class="col-md-5"><!-- logo -->
                            <a href="index.html" title="Job Board" rel="home">
                                <img class="main-logo" style="margin-left: 20px; width: 75%;" src="/media/img/ActEPRLogo.png" alt="Act-EPR" />
                            </a>
                            <br />
                            <br />
                        </div><!-- logo -->
                    </div>
                    <div class="row">
                        <div class="col-md-8  main-nav"><!-- Main Navigation -->
                            <a id="touch-menu" class="mobile-menu" href="#"><i class="fa fa-bars fa-2x"></i></a>
                            <nav>
                                <ul class="menu">
                                    <li><a href="/">HOME</a></li>
                                    <li><a  href="#">WORK PACKAGES</a>
                                        <ul class="sub-menu">
                                            <li><a href="#">WP1 Micro-Helix Resonators</a></li>
                                            <li><a href="#">WP2 Technology Advancements</a></li>
                                            <li><a href="#">WP3 Biological Research</a></li>
                                        </ul>
                                    </li>
                                    <li><a  href="/publications.html">PUBLICATIONS</a></li>
                                    <li><a  href="/blog/">BLOG</a></li>
                                    <li><a  href="#">ABOUT</a></li>
                                </ul>
                            </nav>
                        </div><!-- Main Navigation -->
                        <div class="clearfix"></div>
                    </div>
                </div><!-- container -->
            </div><!-- end main header -->
            <br />
            <div class="container"><!-- Container -->
                <div class="row">
                    <div class="container" id="top">
        <div class="col-md-8 col-md-offset-1">
    <header>
    <h1>Packaging Python software with pbr</h1>
      <div class="meta">
        <small><i class="fa fa-calendar"></i>Monday 02 January 2017</small>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <small>
          <i class="fa fa-folder"></i>
                      <a href="/blog/tags/Python.html">Python</a>,                      <a href="/blog/tags/pbr.html">pbr</a>                  </small>
      </div>
      <hr style="margin-bottom: 2em;" />
    </header>
            <p>Packaging Python has been a painful experience for long. The history of the
various distribution that Python offered along the years is really bumpy, and
both the user and developer experience has been pretty bad.</p>
<p>Fortunately, things improved a lot in the recent years, with the reconciliation
of <em><a href="https://setuptools.readthedocs.io">setuptools</a></em> and <em>distribute</em>.</p>
<p>Though in the context of the <a href="http://openstack.org">OpenStack</a> project, a
solution on top of <em>setuptools</em> has been already started a while back. Its
usage is now spread across a whole range of software and libraries.</p>
<p>This project is called <em><a href="http://docs.openstack.org/developer/pbr/">pbr</a></em>, for
<em>Python Build Reasonableness</em>. Don't be afraid by the OpenStack colored themed
of the documentation – it is a bad habit of OpenStack folks to not advertise
their tooling in an agnostic fashion. The tool has no dependency with the cloud
platform, and can be used painlessly with any package.</p>
<h1>How it works</h1>
<p><em>pbr</em> takes inspiration from <em>distutils2</em> (a now abandoned project) and uses a
<code>setup.cfg</code> file to describe the packager's intents. This is how a <code>setup.py</code>
using <em>pbr</em> looks like:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">setuptools</span><br />&nbsp;<br /><span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">setup_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pbr&#39;</span><span class="p">],</span> <span class="n">pbr</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><br /></pre></div>

<p><br />
Two lines of code – it's that simple. The actual metadata that the setup
requires is stored in <code>setup.cfg</code>:</p>
<div class="highlight"><pre><span></span><span class="k">[metadata]</span><br /><span class="na">name</span> <span class="o">=</span> <span class="s">foobar</span><br /><span class="na">author</span> <span class="o">=</span> <span class="s">Dave Null</span><br /><span class="na">author-email</span> <span class="o">=</span> <span class="s">foobar@example.org</span><br /><span class="na">summary</span> <span class="o">=</span> <span class="s">Package doing nifty stuff</span><br /><span class="na">license</span> <span class="o">=</span> <span class="s">MIT</span><br /><span class="na">description-file</span> <span class="o">=</span><span class="s"></span><br /><span class="s">    README.rst</span><br /><span class="na">home-page</span> <span class="o">=</span> <span class="s">http://pypi.python.org/pypi/foobar</span><br /><span class="na">requires-python</span> <span class="o">=</span> <span class="s">&gt;=2.6</span><br /><span class="na">classifier</span> <span class="o">=</span> <span class="s"></span><br /><span class="s">    Development Status :: 4 - Beta</span><br /><span class="s">    Environment :: Console</span><br /><span class="s">    Intended Audience :: Developers</span><br /><span class="s">    Intended Audience :: Information Technology</span><br /><span class="s">    License :: OSI Approved :: Apache Software License</span><br /><span class="s">    Operating System :: OS Independent</span><br /><span class="s">    Programming Language :: Python</span><br />&nbsp;<br /><span class="k">[files]</span><br /><span class="na">packages</span> <span class="o">=</span><span class="s"></span><br /><span class="s">    foobar</span><br /></pre></div>

<p><br />
This syntax is way easier to write and read than the standard <code>setup.py</code>.</p>
<p><em>pbr</em> also offers other features such as:</p>
<ul>
<li>automatic dependency installation based on <code>requirements.txt</code></li>
<li>automatic documentation building and generation using Sphinx</li>
<li>automatic generation of <code>AUTHORS</code> and <code>ChangeLog</code> files based on <em>git</em> history</li>
<li>automatic creation of the list of files to include using <em>git</em></li>
<li>version management based on <em>git</em> tags</li>
</ul>
<p>All of this comes with little to no effort on your part.</p>
<h1>Using flavors</h1>
<p>One of the feature that I use a lot, is the definition of flavors. It's not
tied particularly to <em>pbr</em> – it's actually provided by <em>setuptools</em> and <em>pip</em>
themselves – but <em>pbr</em> <code>setup.cfg</code> file makes it easy to use.</p>
<p>When distributing a software, it's common to have different drivers for it. For
example, your project could support both PostgreSQL or MySQL – but nobody is
going to use both at the same time. The usual trick to make it work is to add
the needed library to the requirements list (e.g. <code>requirements.txt</code>). The
upside is that the software will work directly with either RDBMS, but the
downside is that this will install both libraries, whereas only one is needed.
Using flavors, you can specify different scenarios:</p>
<div class="highlight"><pre><span></span><span class="k">[extras]</span><br /><span class="na">postgresql</span> <span class="o">=</span><span class="s"></span><br /><span class="s">    psycopg2</span><br /><span class="na">mysql</span> <span class="o">=</span><span class="s"></span><br /><span class="s">    pymysql</span><br /></pre></div>

<p><br />
When installing your package, the user can then just pick the right flavor by
using <em><a href="https://pip.pypa.io/">pip</a></em> to install the package:</p>
<div class="highlight"><pre><span></span>$ pip install foobar<span class="o">[</span>postgresql<span class="o">]</span><br /></pre></div>

<p><br />
This will install <em>foobar</em>, all its dependencies listed in <code>requirements.txt</code>,
plus whatever dependencies are listed in the <code>[extras]</code> section of <code>setup.cfg</code>
matching the flavor. You can also combine several flavors, e.g.:</p>
<div class="highlight"><pre><span></span>$ pip install foobar<span class="o">[</span>postgresql,mysql<span class="o">]</span><br /></pre></div>

<p><br />
would install both flavors.</p>
<p><em>pbr</em> is well-maintained and in very active development, so if you have any
plans to distribute your software, you should seriously consider including
<em>pbr</em> in those plans.</p>          </div>

  </div>
            
                </div> <!-- /row-->
            </div> <!-- /container -->
        </div>
    
    <div id="footer"><!-- Footer -->
        <div class="container"><!-- Container -->
            <div class="row">
                <div style="margin-left: 60px;" class="col-md-5 footer-widget"><!-- Text Widget -->
                    <h6 class="widget-title">Acknowledgements</h6>
                        <div class="textwidget">
                            <a href="http://ec.europa.eu/research/participants/portal/desktop/en/home.html">
                              <img src="/media/img/logo_EUh2020_horizontal.png" />
                            </a>
                            <br /><br />
                            <a href="https://cec.mpg.de/home/">
                              <img src="/media/img/csm_mpi-logo.png" />
                            </a>
                        </div>

                </div><!-- Text Widget -->

                <div style="margin-right:20px;" class="col-md-3 footer-widget"><!-- Recent Tweet Widget -->
                    <h6 class="widget-title">Links of Interest</h6>
                    <div class="recent-twitt">
                    <p class="textwidget" style="text-align: justify;">
                        <a style="color: #f0ce42;" href="https://cec.mpg.de/biophysikalische-chemie/dr-edward-j-reijerse/">Bio Hydrogen Group</a> - Led by Dr. Edward J. Reijerse, the Bio Hydrogen Group looks to understand the chemical reaction of biological hydrogenase in order to create bio-inspired molecular catalysts. 
                    </p>
                </div>
            </div><!-- Recent Tweet Widget -->

            <div class="col-md-3 footer-widget"><!-- News Leter Widget -->
                <h6 class="widget-title">News</h6>
                <div class="textwidget">
                    <p>Act-EPR project starts on 1st May, 2017.</p>
                </div>
            </div><!-- News Leter Widget -->
            <div class="clearfix"></div>
        </div>

        <div class="footer-credits"><!-- Footer credits -->
            2017 &copy; Jason W. Sidabras
        </div><!-- Footer credits -->
    </div><!-- Container -->
</div><!-- Footer -->

</div><!-- end main wrapper -->
 </body>
</html>